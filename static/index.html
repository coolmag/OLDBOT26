<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Aurora Retro Deck</title>
    <style>
        :root{--bg:#121212;--case:#222;--sticker:#e0e0e0;--tape:#3a3a3a;--cyan:#00f3ff;--pink:#ff0055;--gold:#ffcc00}
        body{background-color:var(--bg);color:#333;font-family:'Courier New',monospace;display:flex;flex-direction:column;align-items:center;justify-content:center;height:100vh;margin:0;overflow:hidden;user-select:none}
        .cassette{width:320px;height:200px;background:var(--case);border-radius:12px;position:relative;box-shadow:inset 0 0 30px #000,0 20px 50px rgba(0,0,0,.7),0 0 15px var(--cyan),0 0 30px var(--pink);border:3px solid #333;display:flex;flex-direction:column;align-items:center;padding:15px;transition:transform .1s}
        .screw{position:absolute;width:10px;height:10px;background:#444;border-radius:50%;box-shadow:inset 1px 1px 2px #000}.screw::before,.screw::after{content:'';position:absolute;top:50%;left:15%;width:70%;height:1px;background:#111}.screw::before{transform:rotate(45deg)}.screw::after{transform:rotate(-45deg)}.tl{top:8px;left:8px}.tr{top:8px;right:8px}.bl{bottom:8px;left:8px}.br{bottom:8px;right:8px}
        .label{width:100%;height:120px;background:var(--sticker);border-radius:6px;position:relative;box-shadow:0 2px 5px rgba(0,0,0,.5);display:flex;flex-direction:column;align-items:center;overflow:hidden}.label::before{content:'';position:absolute;top:15px;left:0;width:100%;height:8px;background:linear-gradient(90deg,var(--pink),var(--gold),var(--cyan));opacity:.8}
        .viz-container{position:absolute;top:28px;display:flex;gap:2px;align-items:flex-end;height:20px;opacity:.3;transition:opacity .3s}.playing .viz-container{opacity:1}.bar{width:4px;background:var(--cyan);height:3px;animation:bounce .6s infinite ease-in-out alternate;animation-play-state:paused}.playing .bar{animation-play-state:running}@keyframes bounce{0%{height:2px}100%{height:18px;background:var(--pink)}}
        .info{margin-top:55px;text-align:center;width:90%;z-index:2}.title{font-weight:900;font-size:16px;text-transform:uppercase;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.artist{font-size:12px;color:#666;font-weight:700}
        .window{width:200px;height:50px;background:rgba(20,20,20,.95);border-radius:25px;margin-top:8px;border:2px solid #999;display:flex;justify-content:space-between;align-items:center;padding:0 15px;position:relative;box-shadow:inset 0 0 10px #000}
        .spool{width:36px;height:36px;background:#fff;border-radius:50%;border:6px solid var(--tape);position:relative;box-shadow:0 0 5px #000}.spool::after{content:'';position:absolute;top:0;left:0;right:0;bottom:0;background:radial-gradient(circle,transparent 35%,#fff 36%),conic-gradient(transparent 10%,#aaa 10% 20%,transparent 20% 40%,#aaa 40% 50%,transparent 50% 70%,#aaa 70% 80%,transparent 80%);border-radius:50%;animation:spin 2s linear infinite;animation-play-state:paused}.playing .spool::after{animation-play-state:running}@keyframes spin{100%{transform:rotate(360deg)}}.bridge{width:80px;height:20px;background:#111;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}
        .main-controls{margin-top:25px;display:flex;justify-content:center;align-items:center;gap:10px;width:100%}.btn{background:#2a2a2a;border:none;color:#888;font-family:inherit;font-weight:700;font-size:16px;padding:10px;cursor:pointer;box-shadow:0 3px 0 #000;border-radius:4px;transition:.1s}.btn:active{transform:translateY(3px);box-shadow:none}.play-btn{color:var(--cyan)}.playing .play-btn{color:var(--pink);text-shadow:0 0 5px var(--pink)}
        .search-box{margin-top:20px;display:flex;justify-content:center;width:100%}input{background:#000;border:1px solid #333;color:var(--cyan);font-family:'Courier New',monospace;padding:10px;width:100%;max-width:320px;text-transform:uppercase;outline:none;text-align:center;border-radius:4px}input::placeholder{color:#444}
        #drawer-container{position:fixed;inset:0;z-index:100;pointer-events:none}.overlay{position:absolute;inset:0;background:rgba(0,0,0,.7);opacity:0;transition:opacity .3s}.drawer{position:absolute;bottom:0;left:0;right:0;height:70vh;background:rgba(20,20,30,.9);backdrop-filter:blur(10px);border-radius:16px 16px 0 0;transform:translateY(100%);transition:transform .3s;display:flex;flex-direction:column;padding:15px;border-top:1px solid rgba(255,255,255,.1)}#drawer-title{margin:0 0 15px;text-align:center;font-size:1.2em;color:#fff}#drawer-content{overflow-y:auto;color:#fff}.drawer-container.active{pointer-events:all}.drawer-container.active .overlay{opacity:1}.drawer-container.active .drawer{transform:translateY(0)}.menu-item,.playlist-item{padding:12px;background:rgba(0,0,0,.2);border-radius:4px;margin-bottom:8px;cursor:pointer;transition:background .2s}.menu-item:hover,.playlist-item:hover{background:rgba(255,255,255,.1)}.playlist-item.active{background:var(--pink);color:#fff}
        #ai-modal{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:200;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:15px;padding:20px;opacity:0;pointer-events:none;transition:opacity .3s;backdrop-filter:blur(5px)}.modal.active{opacity:1;pointer-events:all}#ai-input{width:100%;max-width:300px;background:#111;border:1px solid #555;color:#fff;padding:12px;text-align:center;border-radius:4px}
    </style>
</head>
<body>
    <div class="cassette" id="deck">
        <div class="screw tl"></div><div class="screw tr"></div><div class="screw bl"></div><div class="screw br"></div>
        <div class="label">
            <div class="viz-container"><div class="bar" style="animation-duration:.4s"></div><div class="bar" style="animation-duration:.5s"></div><div class="bar" style="animation-duration:.3s"></div><div class="bar" style="animation-duration:.6s"></div><div class="bar" style="animation-duration:.4s"></div><div class="bar" style="animation-duration:.5s"></div><div class="bar" style="animation-duration:.3s"></div><div class="bar" style="animation-duration:.4s"></div></div>
            <div class="info">
                <div class="title" id="title">NO TAPE</div>
                <div class="artist" id="artist">INSERT CASSETTE</div>
            </div>
            <div class="window"><div class="spool"></div><div class="bridge"></div><div class="spool"></div></div>
        </div>
    </div>
    <div class="main-controls">
        <button class="btn" onclick="app.prev()">‚óÄ‚óÄ</button>
        <button class="btn play-btn" id="playBtn" onclick="app.toggle()">PLAY</button>
        <button class="btn" onclick="app.next()">‚ñ∂‚ñ∂</button>
        <button class="btn" onclick="app.ui.toggleDrawer('playlist')">‚ò∞</button>
        <button class="btn" onclick="app.ui.toggleDrawer('genres')">‚ô™</button>
        <button class="btn" onclick="app.ui.toggleAIModal(true)">ü§ñ</button>
    </div>
    <div class="search-box"><input type="text" id="query" placeholder="SEARCH OR USE AI..." onkeypress="if(event.key==='Enter')app.search()"></div>

    <div id="drawer-container"><div class="overlay"></div><div id="drawer" class="drawer"><h3 id="drawer-title"></h3><div id="drawer-content"></div></div></div>
    <div id="ai-modal" class="modal"><input id="ai-input" placeholder="–ß—Ç–æ –≤–∫–ª—é—á–∏—Ç—å?"><button class="btn" onclick="app.askAI()">–ü—É—Å–∫</button><button class="btn" onclick="app.ui.toggleAIModal(false)">–û—Ç–º–µ–Ω–∞</button></div>

    <script>
        const app={store:{_s:{p:[],ci:-1},_l:{},sub(e,t){this._l[e]=this._l[e]||[];this._l[e].push(t)},_n(e,t){this._l[e]&&this._l[e].forEach(e=>e(t))},set(e){Object.assign(this._s,e);e.p&&this._n("p",this._s.p);void 0!==e.ci&&this._n("t",this._s.p[this._s.ci])}},api:{_b:window.location.origin,async _f(e){const t=await fetch(`${this._b}${e}`);if(!t.ok)throw new Error(`HTTP ${t.status}`);return t.json()},search:e=>app.api._f(`/api/player/playlist?query=${encodeURIComponent(e)}`),askAI:e=>app.api._f(`/api/ai/dj?prompt=${encodeURIComponent(e)}`)},player:{audio:new Audio,init(){this.audio.addEventListener("ended",()=>this.next()),this.audio.addEventListener("timeupdate",()=>app.ui.updateProgress(this.audio.currentTime,this.audio.duration)),this.audio.addEventListener("play",()=>app.ui.setPlayState(!0)),this.audio.addEventListener("pause",()=>app.ui.setPlayState(!1)),this.audio.addEventListener("error",()=>app.ui.showError("TAPE ERROR"))},play(e){if(!e)return;app.ui.updateTrackInfo(e),this.audio.src=`${app.api._b}/stream/${e.identifier}`,this.audio.play()},toggle(){this.audio.src&& (this.audio.paused?this.audio.play():this.audio.pause())},next(){let e=app.store._s.ci+1;e>=app.store._s.p.length&&(e=0),app.store.set({ci:e}),this.play(app.store._s.p[e])},prev(){this.audio.currentTime>3?this.audio.currentTime=0:(()=>{let e=app.store._s.ci-1;e<0&&(e=app.store._s.p.length-1),app.store.set({ci:e}),this.play(app.store._s.p[e])})()}},ui:{get:e=>document.getElementById(e),_dr:null,setPlayState(e){this.get("deck").classList.toggle("playing",e),this.get("playBtn").innerText=e?"STOP":"PLAY"},updateTrackInfo(e){e&&(this.get("title").innerText=e.title,this.get("artist").innerText=e.artist)},showError(e){this.get("title").innerText=e,this.setPlayState(!1)},updateProgress(e,t){},toggleDrawer(e){const t=this.get("drawer-container");this._dr&&this._dr===e?this._dr=null:this._dr=e,this._dr?(t.classList.add("active"),this.get("drawer-title").textContent="playlist"===this._dr?"–ü–ª–µ–π–ª–∏—Å—Ç":"–ñ–∞–Ω—Ä—ã",this.renderDrawer()):t.classList.remove("active")},renderDrawer(){const e=this.get("drawer-content");e.innerHTML="","playlist"===this._dr?app.store._s.p.forEach((t,i)=>{const s=document.createElement("div");s.className="playlist-item",i===app.store._s.ci&&(s.className+=" active"),s.textContent=`${t.title} - ${t.artist}`,s.onclick=()=>{app.store.set({ci:i}),app.player.play(t),this.toggleDrawer()},e.appendChild(s)}):"genres"===this._dr&&app.genres.forEach(t=>{const i=document.createElement("div");i.className="menu-item",i.textContent=t.n,i.onclick=()=>{app.search(t.q),this.toggleDrawer()},e.appendChild(i)})},toggleAIModal(e){this.get("ai-modal").classList.toggle("active",e)}},genres:[{n:"üåç Hits",q:"top pop hits 2024"},{n:"üé∏ Rock",q:"classic rock 70s"},{n:"üéß Phonk",q:"drift phonk mix"},{n:"üá∑üá∫ Russian",q:"—Ä—É—Å—Å–∫–∏–µ —Ö–∏—Ç—ã 2024"},{n:"‚ú® Mood",q:"deep focus music"},{n:"üé≤ Random",q:"top hits"}],async search(e){const t=e||this.ui.get("query").value;if(!t)return;this.ui.get("title").innerText="SEARCHING...",this.ui.get("artist").innerText="PLEASE WAIT";try{const e=await this.api.search(t);e.playlist?.length?(this.store.set({p:e.playlist,ci:0}),this.player.play(e.playlist[0])):this.ui.showError("NOT FOUND")}catch{this.ui.showError("NET ERROR")}},async askAI(){const e=this.ui.get("ai-input").value;if(!e)return;this.ui.toggleAIModal(!1),this.ui.get("title").innerText="AI THINKING...",this.ui.get("artist").innerText="PLEASE WAIT";try{const t=await this.api.askAI(e);t.playlist?.length?(this.store.set({p:t.playlist,ci:0}),this.player.play(t.playlist[0])):this.ui.showError("AI NOT FOUND")}catch{this.ui.showError("AI ERROR")}},init(){this.player.init(),this.store.sub("t",e=>this.ui.updateTrackInfo(e)),this.store.sub("p",e=>this.ui._dr&&this.ui.renderDrawer()),this.ui.get("overlay").onclick=()=>this.ui.toggleDrawer()}};document.addEventListener("DOMContentLoaded",()=>app.init());
    </script>
</body>
</html>