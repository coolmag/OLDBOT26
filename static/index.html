<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <title>Aurora –°–í–ï–ú–ê</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { 
            --bg: #0d0d0f; --cyan: #00f3ff; --pink: #ff0055; --btn-bg: #1a1a1c;
            --tape-l: 75px; /* –†–∞–∑–º–µ—Ä –ª–µ–≤–æ–π –∫–∞—Ç—É—à–∫–∏ –ø–ª–µ–Ω–∫–∏ */
            --tape-r: 28px; /* –†–∞–∑–º–µ—Ä –ø—Ä–∞–≤–æ–π –∫–∞—Ç—É—à–∫–∏ –ø–ª–µ–Ω–∫–∏ */
        }
        
        body { background-color: var(--bg); background-image: radial-gradient(circle at center, #1a1a1f 0%, #000 100%); color: #fff; font-family: 'SF Mono', 'Cascadia Code', 'Roboto Mono', 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; user-select: none; }
        
        /* –ò–ù–§–û –û –¢–†–ï–ö–ï (–ß–µ—Ç–∫–∏–π —à—Ä–∏—Ñ—Ç, –Ω–µ–æ–Ω–æ–≤–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ) */
        .info { text-align: center; width: 100%; max-width: 340px; margin-bottom: 25px; padding: 10px; border-radius: 8px; background: rgba(0,0,0,0.4); border: 1px solid rgba(0, 243, 255, 0.1); box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        .title { color: #fff; font-weight: 900; font-size: 17px; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; text-shadow: 0 0 10px rgba(255,255,255,0.5); letter-spacing: 0.5px;}
        .artist { font-size: 14px; color: var(--cyan); font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; display: block; margin-top: 4px; text-transform: uppercase; letter-spacing: 1px;}

        /* –§–û–¢–û–†–ï–ê–õ–ò–°–¢–ò–ß–ù–ê–Ø –ö–ê–°–°–ï–¢–ê –°–í–ï–ú–ê */
        .cassette {
            width: 350px; height: 220px; 
            background: linear-gradient(to bottom, #eeeeeb, #dcdcd8);
            border-radius: 14px; position: relative;
            box-shadow: 
                inset 0 2px 3px rgba(255,255,255,0.9), 
                inset 0 -4px 6px rgba(0,0,0,0.2), 
                0 30px 40px rgba(0,0,0,0.8),
                0 0 0 1px #888; /* –¢–æ–Ω–∫–∞—è —Ä–∞–º–∫–∞ –ø–ª–∞—Å—Ç–∏–∫–∞ */
            display: flex; flex-direction: column; align-items: center; padding: 15px; 
            transition: transform 0.1s;
        }
        /* –°–∫–æ—Å (–¢—Ä–∞–ø–µ—Ü–∏—è –≤–Ω–∏–∑—É) */
        .cassette::after {
            content: ''; position: absolute; bottom: 0; left: 10%; width: 80%; height: 20px;
            background: linear-gradient(to bottom, #dcdcd8, #cececa);
            border-radius: 4px 4px 0 0; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        /* –ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∏–µ –í–∏–Ω—Ç–∏–∫–∏ (–ö—Ä–µ—Å—Ç–æ–≤—ã–µ) */
        .screw { position: absolute; width: 14px; height: 14px; background: linear-gradient(135deg, #d4d4d4, #888); border-radius: 50%; box-shadow: inset 1px 1px 3px rgba(0,0,0,0.6), 0 1px 1px rgba(255,255,255,0.8); border: 1px solid #666; }
        .screw::before, .screw::after { content: ''; position: absolute; top: 50%; left: 20%; width: 60%; height: 1.5px; background: rgba(0,0,0,0.7); box-shadow: 0 1px 0 rgba(255,255,255,0.3); }
        .screw::before { transform: translateY(-50%) rotate(45deg); } .screw::after { transform: translateY(-50%) rotate(-45deg); }
        .tl { top: 12px; left: 12px; } .tr { top: 12px; right: 12px; } .bl { bottom: 12px; left: 12px; } .br { bottom: 12px; right: 12px; }

        /* –ë—É–º–∞–∂–Ω–∞—è –ù–∞–∫–ª–µ–π–∫–∞ */
        .label {
            width: 92%; height: 140px; background: #faf9f5; border-radius: 8px; position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.03), 0 1px 3px rgba(0,0,0,0.3);
            border: 1px solid rgba(0,0,0,0.1); display: flex; flex-direction: column; align-items: center; overflow: hidden;
            background-image: repeating-linear-gradient(0deg, transparent, transparent 4px, rgba(0,0,0,0.01) 4px, rgba(0,0,0,0.01) 5px); /* –¢–µ–∫—Å—Ç—É—Ä–∞ –±—É–º–∞–≥–∏ */
        }

        /* –¢–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ –°–≤–µ–º–∞ */
        .svema-logo { position: absolute; top: 14px; left: 16px; border: 2px solid #c1121f; color: #c1121f; padding: 2px 8px; font-family: 'Times New Roman', Times, serif; font-weight: 900; font-size: 16px; border-radius: 4px; letter-spacing: 1.5px; text-shadow: 0 0 1px rgba(193,18,31,0.3); }
        .red-lines { position: absolute; top: 20px; right: 16px; width: 48%; height: 10px; border-top: 2.5px solid #c1121f; border-bottom: 2.5px solid #c1121f; }
        
        .black-block { position: absolute; top: 50px; width: 100%; height: 55px; background: #181818; display: flex; justify-content: center; align-items: center; box-shadow: inset 0 3px 6px #000, 0 1px 1px rgba(255,255,255,0.5); }
        
        .green-block { position: absolute; bottom: 10px; width: 92%; height: 24px; background: #8fb399; display: flex; justify-content: space-between; align-items: center; padding: 0 12px; color: #a00; font-family: 'Arial Black', sans-serif; font-weight: 900; font-size: 17px; border: 1px solid #789981; box-shadow: inset 0 1px 3px rgba(255,255,255,0.4); }

        /* –ê–∫—Ä–∏–ª–æ–≤–æ–µ –û–∫–æ—à–∫–æ –∏ –ú–∞–≥–Ω–∏—Ç–Ω–∞—è –ø–ª–µ–Ω–∫–∞ */
        .window {
            width: 220px; height: 38px; background: rgba(255,255,255,0.1); border-radius: 5px;
            border: 2px solid #444; border-top: 3px solid #222; border-bottom: 2px solid #777;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 18px; position: relative; box-shadow: inset 0 0 12px rgba(0,0,0,0.9);
            overflow: hidden; backdrop-filter: blur(1px); /* –≠—Ñ—Ñ–µ–∫—Ç –º—É—Ç–Ω–æ–≥–æ –ø–ª–∞—Å—Ç–∏–∫–∞ */
        }
        
        /* –ë–ª–∏–∫ –Ω–∞ —Å—Ç–µ–∫–ª–µ */
        .window::before { content: ''; position: absolute; top: 0; left: -50%; width: 200%; height: 100%; background: linear-gradient(115deg, transparent 40%, rgba(255,255,255,0.15) 45%, transparent 50%); z-index: 10; pointer-events: none; }

        /* –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ò–ï –†–£–õ–û–ù–´ –ü–õ–ï–ù–ö–ò (–¢–µ–º–Ω–æ-–∫–æ—Ä–∏—á–Ω–µ–≤–∞—è —Ç–µ–∫—Å—Ç—É—Ä–∞ –º–∞–≥–Ω–∏—Ç–Ω–æ–π –ª–µ–Ω—Ç—ã) */
        .tape-roll { position: absolute; bottom: -10px; border-radius: 50%; background: radial-gradient(circle, #2a221f 0%, #111 80%); box-shadow: 0 0 0 1px #000, 0 0 6px #000; transition: width 0.3s linear, height 0.3s linear; z-index: 1; }
        .tape-left { left: 40px; width: var(--tape-l); height: var(--tape-l); transform: translateX(-50%); }
        .tape-right { right: 40px; width: var(--tape-r); height: var(--tape-r); transform: translateX(50%); }

        /* –ò–¥–µ–∞–ª—å–Ω—ã–µ —à–µ—Å—Ç–∏–≥—Ä–∞–Ω–Ω—ã–µ —à–ø–∏–Ω–¥–µ–ª–∏ */
        .spool { width: 30px; height: 30px; border-radius: 50%; background: #e0e0e0; position: relative; z-index: 5; box-shadow: 0 2px 4px rgba(0,0,0,0.8), inset 0 0 2px #fff; border: 1px solid #999; }
        .spool-teeth {
            position: absolute; inset: 2px; border-radius: 50%;
            background: repeating-conic-gradient(#333 0deg, #333 30deg, #ddd 30deg, #ddd 60deg);
            -webkit-mask-image: radial-gradient(circle, transparent 35%, black 36%);
            mask-image: radial-gradient(circle, transparent 35%, black 36%);
            animation: spin 2.5s linear infinite; animation-play-state: paused;
        }
        .spool::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 10px; height: 10px; background: #111; border-radius: 50%; }
        .playing .spool-teeth { animation-play-state: running; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* –ù–µ–æ–Ω–æ–≤—ã–π –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä */
        .progress-wrapper { width: 100%; max-width: 350px; height: 6px; background: rgba(0,0,0,0.6); border-radius: 3px; overflow: hidden; border: 1px solid #333; margin-top: 25px; cursor: pointer;}
        .progress-fill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--cyan), var(--pink)); box-shadow: 0 0 10px var(--pink); transition: width 0.1s linear; }

        /* –ú–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏–µ –ö–Ω–æ–ø–∫–∏ */
        .main-controls { margin-top: 15px; display: flex; justify-content: center; align-items: center; gap: 10px; width: 100%; }
        .btn {
            background: var(--btn-bg); border: 1px solid #333; color: #999; font-family: inherit;
            font-weight: bold; font-size: 15px; padding: 14px 18px; cursor: pointer;
            box-shadow: inset 0 1px 1px rgba(255,255,255,0.1), 0 4px 0 #000, 0 6px 10px rgba(0,0,0,0.5); 
            border-radius: 8px; transition: all 0.1s; display: flex; align-items: center; justify-content: center;
        }
        .btn:active { transform: translateY(4px); box-shadow: 0 0 0 #000, inset 0 2px 5px rgba(0,0,0,0.5); color: #fff; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: 0 4px 0 #000; }
        .play-btn { color: var(--cyan); border-color: #005555; min-width: 90px; font-size: 16px; font-weight: 900; letter-spacing: 1px;}
        .playing .play-btn { color: #fff; background: var(--pink); border-color: #ff0055; text-shadow: 0 1px 2px rgba(0,0,0,0.5); box-shadow: 0 4px 0 #880022, 0 0 20px rgba(255,0,85,0.4); }

        /* –ü–æ–∏—Å–∫ */
        .search-box { margin-top: 25px; width: 100%; max-width: 350px; display: flex; justify-content: center; }
        input {
            background: rgba(0,0,0,0.5); border: 1px solid #444; color: #fff; font-family: inherit; font-weight: bold;
            padding: 14px; width: 100%; text-transform: uppercase; outline: none; text-align: center; font-size: 15px;
            border-radius: 8px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.5); transition: all 0.3s;
        }
        input:focus { border-color: var(--cyan); box-shadow: inset 0 2px 5px rgba(0,0,0,0.5), 0 0 10px rgba(0,243,255,0.2); }
        input::placeholder { color: #666; font-weight: normal; }

        /* –û–∫–Ω–∞ –º–µ–Ω—é */
        .drawer-container { position: fixed; inset: 0; z-index: 100; pointer-events: none; }
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); opacity: 0; transition: opacity 0.3s; }
        .drawer {
            position: absolute; bottom: 0; left: 0; right: 0; height: 75vh; background: #121214;
            border-radius: 24px 24px 0 0; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.1, 1, 0.5, 1);
            display: flex; flex-direction: column; padding: 25px 20px; border-top: 1px solid rgba(255,255,255,0.1); box-shadow: 0 -10px 50px rgba(0,0,0,0.8);
        }
        .drawer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        #drawer-title { margin: 0; color: #fff; font-size: 18px; font-weight: 900; letter-spacing: 1px; }
        .close-btn { background: rgba(255,255,255,0.1); border: none; color: #fff; width: 36px; height: 36px; border-radius: 50%; font-size: 24px; cursor: pointer; display: flex; align-items: center; justify-content: center; line-height: 0; transition: background 0.2s; }
        .close-btn:active { background: rgba(255,255,255,0.2); }
        #drawer-content { overflow-y: auto; color: #fff; padding-bottom: 20px; }
        .drawer-container.active { pointer-events: all; } .drawer-container.active .overlay { opacity: 1; } .drawer-container.active .drawer { transform: translateY(0); }
        
        .menu-item, .playlist-item {
            padding: 16px; background: rgba(255,255,255,0.03); border-radius: 12px; margin-bottom: 12px;
            cursor: pointer; transition: all 0.2s; border: 1px solid rgba(255,255,255,0.02);
        }
        .menu-item:active, .playlist-item:active { background: rgba(255,255,255,0.08); transform: scale(0.98); }
        .playlist-item.active { background: rgba(0, 243, 255, 0.1); border-color: var(--cyan); color: var(--cyan); font-weight: bold; }

        .modal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 200; display: flex; flex-direction: column;
            justify-content: center; align-items: center; gap: 20px; padding: 20px; opacity: 0; pointer-events: none;
            transition: opacity 0.3s; backdrop-filter: blur(10px);
        }
        .modal.active { opacity: 1; pointer-events: all; }
    </style>
</head>
<body>

    <div class="info">
        <span class="title" id="title">–ê–í–†–û–†–ê –°–í–ï–ú–ê</span>
        <span class="artist" id="artist">–û–ñ–ò–î–ê–ù–ò–ï –ö–ê–°–°–ï–¢–´</span>
    </div>

    <div class="cassette" id="deck">
        <div class="screw tl"></div><div class="screw tr"></div><div class="screw bl"></div><div class="screw br"></div>
        <div class="label">
            <div class="svema-logo">–°–≤–µ–º–∞</div>
            <div class="red-lines"></div>
            
            <div class="black-block">
                <div class="window">
                    <div class="tape-roll tape-left"></div>
                    <div class="tape-roll tape-right"></div>
                    <div class="spool"><div class="spool-teeth"></div></div>
                    <div class="spool"><div class="spool-teeth"></div></div>
                </div>
            </div>

            <div class="green-block">
                <span>–ú–ö-60-5</span>
                <span style="color:#333; font-size:13px;">1991</span>
            </div>
        </div>
    </div>

    <div class="progress-wrapper" id="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>

    <div class="main-controls">
        <button class="btn" id="btn-prev" onclick="app.player.prev()">‚óÄ‚óÄ</button>
        <button class="btn play-btn" id="playBtn" onclick="app.player.toggle()">–ü–£–°–ö</button>
        <button class="btn" id="btn-next" onclick="app.player.next()">‚ñ∂‚ñ∂</button>
        <button class="btn" onclick="app.ui.toggleDrawer('playlist')">‚ò∞</button>
        <button class="btn" onclick="app.ui.toggleDrawer('genres')">‚ô™</button>
        <button class="btn" onclick="app.ui.toggleAIModal(true)">ü§ñ</button>
    </div>

    <form class="search-box" onsubmit="app.search(); return false;">
        <input type="text" id="query" placeholder="–ü–û–ò–°–ö –ò–õ–ò –ò–ò...">
    </form>

    <div id="drawer-container" class="drawer-container">
        <div class="overlay" id="overlay-bg"></div>
        <div id="drawer" class="drawer">
            <div class="drawer-header">
                <h3 id="drawer-title">–ú–ï–ù–Æ</h3>
                <button class="close-btn" onclick="app.ui.toggleDrawer()">&times;</button>
            </div>
            <div id="drawer-content"></div>
        </div>
    </div>

    <form id="ai-modal" class="modal" onsubmit="app.askAI(); return false;">
        <h3 style="color:var(--cyan); margin-bottom: 0; font-size:22px; letter-spacing:1px;">–ò–ò –î–ò–î–ñ–ï–ô</h3>
        <input type="text" id="ai-input" placeholder="–ß–¢–û –ù–ê–ô–¢–ò –î–õ–Ø –í–ê–°?">
        <div style="display:flex; gap:15px; width: 100%; max-width: 320px;">
            <button type="submit" class="btn play-btn" id="ai-btn">–í–†–£–ë–ê–ô</button>
            <button type="button" class="btn" onclick="app.ui.toggleAIModal(false)" style="flex:1;">–û–¢–ú–ï–ù–ê</button>
        </div>
    </form>

    <script>
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.expand();
            window.Telegram.WebApp.ready();
        }

        const app = {
            store: {
                _s: { p: [], ci: -1 },
                _l: {},
                sub(event, callback) { this._l[event] = this._l[event] || []; this._l[event].push(callback); },
                _n(event, data) { if (this._l[event]) this._l[event].forEach(cb => cb(data)); },
                set(newState) {
                    Object.assign(this._s, newState);
                    if (newState.p) this._n("p", this._s.p);
                    if (newState.ci !== undefined) this._n("t", this._s.p[this._s.ci]);
                }
            },
            
            api: {
                _b: window.location.origin,
                async _f(endpoint) {
                    const res = await fetch(`${this._b}${endpoint}`);
                    if (!res.ok) throw new Error(`HTTP ${res.status}`);
                    return res.json();
                },
                search: (q) => app.api._f(`/api/player/playlist?query=${encodeURIComponent(q)}`),
                askAI: (q) => app.api._f(`/api/ai/dj?prompt=${encodeURIComponent(q)}`)
            },
            
            player: {
                audio: new Audio(),
                init() {
                    this.audio.addEventListener("ended", () => this.next());
                    this.audio.addEventListener("timeupdate", () => app.ui.updateProgress(this.audio.currentTime, this.audio.duration));
                    this.audio.addEventListener("play", () => app.ui.setPlayState(true));
                    this.audio.addEventListener("pause", () => app.ui.setPlayState(false));
                    this.audio.addEventListener("error", () => {
                        app.ui.showError("–ü–õ–ï–ù–ö–ê –ó–ê–ñ–ï–í–ê–ù–ê");
                        setTimeout(() => { if (app.store._s.p.length > 1) this.next(); }, 2000);
                    });
                },
                play(track) {
                    if (!track) return;
                    app.ui.updateTrackInfo(track);
                    this.audio.src = `${app.api._b}/stream/${track.identifier}`;
                    this.audio.play();
                },
                toggle() {
                    if (this.audio.src) {
                        this.audio.paused ? this.audio.play() : this.audio.pause();
                    }
                },
                next() {
                    if (app.store._s.p.length === 0) return;
                    let i = app.store._s.ci + 1;
                    if (i >= app.store._s.p.length) i = 0;
                    app.store.set({ ci: i });
                    this.play(app.store._s.p[i]);
                },
                prev() {
                    if (app.store._s.p.length === 0) return;
                    if (this.audio.currentTime > 3) {
                        this.audio.currentTime = 0;
                    } else {
                        let i = app.store._s.ci - 1;
                        if (i < 0) i = app.store._s.p.length - 1;
                        app.store.set({ ci: i });
                        this.play(app.store._s.p[i]);
                    }
                }
            },
            
            ui: {
                get: (id) => document.getElementById(id),
                _dr: null,
                setPlayState(isPlaying) {
                    this.get("deck").classList.toggle("playing", isPlaying);
                    this.get("playBtn").innerText = isPlaying ? "–°–¢–û–ü" : "–ü–£–°–ö";
                },
                updateTrackInfo(track) {
                    if (track) {
                        this.get("title").innerText = track.title || "–ù–ï–ò–ó–í–ï–°–¢–ù–û";
                        this.get("artist").innerText = track.artist || track.uploader || "–ù–ï–ò–ó–í–ï–°–¢–ù–û";
                    }
                },
                showError(msg) {
                    this.get("title").innerText = msg;
                    this.get("artist").innerText = "";
                    this.setPlayState(false);
                },
                setLoading(isLoading) {
                    this.get("playBtn").disabled = isLoading;
                    this.get("btn-next").disabled = isLoading;
                    this.get("btn-prev").disabled = isLoading;
                    if (isLoading) {
                        this.get("title").innerText = "–ù–ê–°–¢–†–û–ô–ö–ê –ß–ê–°–¢–û–¢–´...";
                        this.get("artist").innerText = "–û–ñ–ò–î–ê–ô–¢–ï...";
                    }
                },
                updateProgress(current, total) {
                    if (total > 0) {
                        const percent = current / total;
                        this.get("progress-fill").style.width = `${percent * 100}%`;
                        
                        // –ú–ê–ì–ò–Ø –§–ò–ó–ò–ö–ò –ü–õ–ï–ù–ö–ò
                        const maxTape = 75; const minTape = 28;
                        const leftSize = maxTape - (percent * (maxTape - minTape));
                        const rightSize = minTape + (percent * (maxTape - minTape));
                        document.documentElement.style.setProperty('--tape-l', `${leftSize}px`);
                        document.documentElement.style.setProperty('--tape-r', `${rightSize}px`);
                    }
                },
                toggleDrawer(drawerType) {
                    const container = this.get("drawer-container");
                    if (this._dr && this._dr === drawerType) { this._dr = null; } else { this._dr = drawerType; }
                    if (this._dr) {
                        container.classList.add("active");
                        this.get("drawer-title").textContent = this._dr === "playlist" ? "–û–ß–ï–†–ï–î–¨ –¢–†–ï–ö–û–í" : "–ö–ê–¢–ê–õ–û–ì –ñ–ê–ù–†–û–í";
                        this.renderDrawer();
                    } else { container.classList.remove("active"); }
                },
                renderDrawer() {
                    const content = this.get("drawer-content");
                    content.innerHTML = "";
                    if (this._dr === "playlist") {
                        if (app.store._s.p.length === 0) content.innerHTML = "<div style='text-align:center;color:#666;margin-top:20px;'>–ö–ê–°–°–ï–¢–ê –ü–£–°–¢–ê</div>";
                        app.store._s.p.forEach((track, i) => {
                            const div = document.createElement("div");
                            div.className = "playlist-item" + (i === app.store._s.ci ? " active" : "");
                            div.textContent = `${track.title} - ${track.artist || track.uploader}`;
                            div.onclick = () => { app.store.set({ ci: i }); app.player.play(track); this.toggleDrawer(); };
                            content.appendChild(div);
                        });
                    } else if (this._dr === "genres") {
                        app.genres.forEach(genre => {
                            const div = document.createElement("div"); div.className = "menu-item"; div.textContent = genre.n;
                            div.onclick = () => { app.search(genre.q); this.toggleDrawer(); };
                            content.appendChild(div);
                        });
                    }
                },
                toggleAIModal(show) { this.get("ai-modal").classList.toggle("active", show); }
            },
            
            genres: [
                { n: "üåç –ú–∏—Ä–æ–≤—ã–µ —Ö–∏—Ç—ã", q: "top pop hits 2024" },
                { n: "üé∏ –†–æ–∫ –ª–µ–≥–µ–Ω–¥—ã", q: "classic rock 70s" },
                { n: "üéß –î—Ä–∏—Ñ—Ç –§–æ–Ω–∫", q: "drift phonk mix" },
                { n: "üá∑üá∫ –†—É—Å—Å–∫–∞—è –ø–æ–ø—Å–∞", q: "—Ä—É—Å—Å–∫–∏–µ —Ö–∏—Ç—ã 2024" },
                { n: "‚ú® –ß–∏–ª–ª / –†–∞–±–æ—Ç–∞", q: "deep focus music" },
                { n: "üé≤ –ú–Ω–µ –ø–æ–≤–µ–∑–µ—Ç", q: "top hits mix" }
            ],
            
            async search(queryStr) {
                const q = (typeof queryStr === 'string') ? queryStr : this.ui.get("query").value;
                if (!q) return;
                this.ui.setLoading(true);
                try {
                    const res = await this.api.search(q);
                    if (res.playlist && res.playlist.length > 0) {
                        this.store.set({ p: res.playlist, ci: 0 });
                        this.player.play(res.playlist[0]);
                    } else { this.ui.showError("–¢–†–ï–ö –ù–ï –ù–ê–ô–î–ï–ù"); }
                } catch (e) { this.ui.showError("–ù–ï–¢ –°–ò–ì–ù–ê–õ–ê"); }
                finally { this.ui.setLoading(false); }
            },
            
            async askAI() {
                const q = this.ui.get("ai-input").value;
                if (!q) return;
                
                // –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ê –ê–£–î–ò–û (–°–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —Å –∫–ª–∏–∫–æ–º)
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.resume();
                    window.speechSynthesis.speak(new SpeechSynthesisUtterance(''));
                }

                this.ui.toggleAIModal(false);
                this.ui.setLoading(true);
                
                try {
                    const res = await this.api.askAI(q);
                    
                    if (res.message && 'speechSynthesis' in window) {
                        window.speechSynthesis.cancel();
                        const utterance = new SpeechSynthesisUtterance(res.message);
                        utterance.lang = 'ru-RU';
                        utterance.rate = 1.1;
                        window.speechSynthesis.speak(utterance);
                    }
                    
                    if (res.playlist && res.playlist.length > 0) {
                        this.store.set({ p: res.playlist, ci: 0 });
                        this.player.play(res.playlist[0]);
                    } else { this.ui.showError("–ò–ò –ù–ï –ù–ê–®–ï–õ"); }
                } catch (e) { this.ui.showError("–°–ë–û–ô –ò–ò"); }
                finally { this.ui.setLoading(false); }
            },
            
            init() {
                this.player.init();
                this.store.sub("t", track => this.ui.updateTrackInfo(track));
                this.store.sub("p", () => { if (this.ui._dr) this.ui.renderDrawer(); });
                this.ui.get("overlay-bg").onclick = () => this.ui.toggleDrawer();
                
                // –ü–µ—Ä–µ–º–æ—Ç–∫–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –±–∞—Ä
                this.ui.get("progress-bar").onclick = (e) => {
                    const rect = e.currentTarget.getBoundingClientRect();
                    app.player.audio.currentTime = ((e.clientX - rect.left) / rect.width) * app.player.audio.duration;
                };
            }
        };

        document.addEventListener("DOMContentLoaded", () => app.init());
    </script>
</body>
</html>